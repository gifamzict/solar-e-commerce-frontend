<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        .test-button:hover {
            background: #5568d3;
        }

        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            overflow-x: auto;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-success {
            background: #28a745;
            color: white;
        }

        .status-error {
            background: #dc3545;
            color: white;
        }

        .status-pending {
            background: #ffc107;
            color: #000;
        }

        .config-item {
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .test-all {
            background: #28a745;
            font-size: 16px;
            padding: 15px 30px;
        }

        .test-all:hover {
            background: #218838;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>üß™ Backend API Integration Test</h1>
        <p>Testing connection to Railway Backend: <code>https://web-production-e65f7.up.railway.app/api</code></p>
    </div>

    <div class="test-section">
        <h2>üìã Configuration Check</h2>
        <div class="config-item">
            <strong>API Base URL:</strong> https://web-production-e65f7.up.railway.app/api
        </div>
        <div class="config-item">
            <strong>Platform:</strong> Railway
        </div>
        <div class="config-item">
            <strong>Frontend:</strong> shop.gifamz.com (Production) | localhost:8080 (Development)
        </div>
    </div>

    <div class="test-section">
        <h2>üöÄ Quick Test All Endpoints</h2>
        <button class="test-button test-all" onclick="testAll()">Run All Tests</button>
        <div id="test-all-result"></div>
    </div>

    <div class="test-section">
        <h2>1Ô∏è‚É£ Test Categories Endpoint</h2>
        <p>Tests if categories can be fetched from the backend</p>
        <button class="test-button" onclick="testCategories()">Test Categories</button>
        <div id="categories-result"></div>
    </div>

    <div class="test-section">
        <h2>2Ô∏è‚É£ Test Products Endpoint</h2>
        <p>Tests if products can be fetched with pagination</p>
        <button class="test-button" onclick="testProducts()">Test Products</button>
        <div id="products-result"></div>
    </div>

    <div class="test-section">
        <h2>3Ô∏è‚É£ Test Promotions Endpoint</h2>
        <p>Tests if promotions can be fetched</p>
        <button class="test-button" onclick="testPromotions()">Test Promotions</button>
        <div id="promotions-result"></div>
    </div>

    <div class="test-section">
        <h2>4Ô∏è‚É£ Test Settings Endpoint</h2>
        <p>Tests if app settings can be fetched</p>
        <button class="test-button" onclick="testSettings()">Test Settings</button>
        <div id="settings-result"></div>
    </div>

    <div class="test-section">
        <h2>5Ô∏è‚É£ Test Registration Endpoint</h2>
        <p>Tests if user registration endpoint is working (validation test)</p>
        <button class="test-button" onclick="testRegistration()">Test Registration</button>
        <div id="registration-result"></div>
    </div>

    <div class="test-section">
        <h2>6Ô∏è‚É£ Test Response Times</h2>
        <p>Measures API response times</p>
        <button class="test-button" onclick="testPerformance()">Test Performance</button>
        <div id="performance-result"></div>
    </div>

    <script>
        const API_BASE_URL = 'https://web-production-e65f7.up.railway.app/api';

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result ${type}">${message}</div>`;
        }

        async function testCategories() {
            const resultId = 'categories-result';
            showResult(resultId, '‚è≥ Testing...', 'info');

            try {
                const startTime = Date.now();
                const response = await fetch(`${API_BASE_URL}/categories`);
                const endTime = Date.now();
                const data = await response.json();

                if (response.ok) {
                    const message = `‚úÖ SUCCESS!\n\nStatus: ${response.status} OK\nTime: ${endTime - startTime}ms\n\nResponse:\n${JSON.stringify(data, null, 2)}\n\nNote: Empty array is expected if no categories added yet.`;
                    showResult(resultId, message, 'success');
                } else {
                    showResult(resultId, `‚ùå Error: ${response.status}\n\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                showResult(resultId, `‚ùå Network Error: ${error.message}\n\nPossible causes:\n- CORS not configured for this domain\n- Backend is down\n- Network connectivity issues`, 'error');
            }
        }

        async function testProducts() {
            const resultId = 'products-result';
            showResult(resultId, '‚è≥ Testing...', 'info');

            try {
                const startTime = Date.now();
                const response = await fetch(`${API_BASE_URL}/products`);
                const endTime = Date.now();
                const data = await response.json();

                if (response.ok) {
                    const message = `‚úÖ SUCCESS!\n\nStatus: ${response.status} OK\nTime: ${endTime - startTime}ms\n\nResponse:\n${JSON.stringify(data, null, 2)}\n\nNote: Empty data array is expected if no products added yet.`;
                    showResult(resultId, message, 'success');
                } else {
                    showResult(resultId, `‚ùå Error: ${response.status}\n\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                showResult(resultId, `‚ùå Network Error: ${error.message}`, 'error');
            }
        }

        async function testPromotions() {
            const resultId = 'promotions-result';
            showResult(resultId, '‚è≥ Testing...', 'info');

            try {
                const startTime = Date.now();
                const response = await fetch(`${API_BASE_URL}/promotions`);
                const endTime = Date.now();
                const data = await response.json();

                if (response.ok) {
                    const message = `‚úÖ SUCCESS!\n\nStatus: ${response.status} OK\nTime: ${endTime - startTime}ms\n\nResponse:\n${JSON.stringify(data, null, 2)}`;
                    showResult(resultId, message, 'success');
                } else {
                    showResult(resultId, `‚ùå Error: ${response.status}\n\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                showResult(resultId, `‚ùå Network Error: ${error.message}`, 'error');
            }
        }

        async function testSettings() {
            const resultId = 'settings-result';
            showResult(resultId, '‚è≥ Testing...', 'info');

            try {
                const startTime = Date.now();
                const response = await fetch(`${API_BASE_URL}/settings`);
                const endTime = Date.now();
                const data = await response.json();

                if (response.ok) {
                    const message = `‚úÖ SUCCESS!\n\nStatus: ${response.status} OK\nTime: ${endTime - startTime}ms\n\nResponse:\n${JSON.stringify(data, null, 2)}`;
                    showResult(resultId, message, 'success');
                } else {
                    showResult(resultId, `‚ùå Error: ${response.status}\n\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                showResult(resultId, `‚ùå Network Error: ${error.message}`, 'error');
            }
        }

        async function testRegistration() {
            const resultId = 'registration-result';
            showResult(resultId, '‚è≥ Testing validation...', 'info');

            try {
                const testData = {
                    first_name: "Test",
                    last_name: "User",
                    email: "invalid-email", // Intentionally invalid to test validation
                    password: "123", // Too short
                    password_confirmation: "123"
                };

                const startTime = Date.now();
                const response = await fetch(`${API_BASE_URL}/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                const endTime = Date.now();
                const data = await response.json();

                if (response.status === 422) {
                    const message = `‚úÖ VALIDATION WORKING!\n\nStatus: ${response.status} (Validation Error - Expected)\nTime: ${endTime - startTime}ms\n\nValidation Errors:\n${JSON.stringify(data, null, 2)}\n\nThis confirms the endpoint is working and validating data correctly!`;
                    showResult(resultId, message, 'success');
                } else if (response.ok) {
                    const message = `‚úÖ Registration endpoint is working!\n\nStatus: ${response.status}\nTime: ${endTime - startTime}ms\n\nResponse:\n${JSON.stringify(data, null, 2)}`;
                    showResult(resultId, message, 'success');
                } else {
                    showResult(resultId, `‚ö†Ô∏è Unexpected response: ${response.status}\n\n${JSON.stringify(data, null, 2)}`, 'info');
                }
            } catch (error) {
                showResult(resultId, `‚ùå Network Error: ${error.message}`, 'error');
            }
        }

        async function testPerformance() {
            const resultId = 'performance-result';
            showResult(resultId, '‚è≥ Running performance tests...', 'info');

            const endpoints = [
                { name: 'Categories', url: `${API_BASE_URL}/categories` },
                { name: 'Products', url: `${API_BASE_URL}/products` },
                { name: 'Promotions', url: `${API_BASE_URL}/promotions` }
            ];

            let results = 'üìä Performance Test Results:\n\n';

            for (const endpoint of endpoints) {
                try {
                    const startTime = Date.now();
                    const response = await fetch(endpoint.url);
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;

                    const status = response.ok ? '‚úÖ' : '‚ùå';
                    const rating = responseTime < 1000 ? 'üöÄ Fast' :
                        responseTime < 2000 ? '‚ö° Good' :
                            responseTime < 3000 ? '‚è±Ô∏è Acceptable' :
                                'üêå Slow';

                    results += `${status} ${endpoint.name}: ${responseTime}ms ${rating}\n`;
                } catch (error) {
                    results += `‚ùå ${endpoint.name}: Failed (${error.message})\n`;
                }
            }

            results += '\n\nNote: Response times of 1-2 seconds are normal for Railway free tier.';
            showResult(resultId, results, 'info');
        }

        async function testAll() {
            const resultId = 'test-all-result';
            showResult(resultId, '‚è≥ Running all tests... Please wait...', 'info');

            const tests = [
                { name: 'Categories', func: testCategories },
                { name: 'Products', func: testProducts },
                { name: 'Promotions', func: testPromotions },
                { name: 'Settings', func: testSettings },
                { name: 'Registration', func: testRegistration }
            ];

            let summary = 'üìä Test Summary:\n\n';
            let passed = 0;
            let failed = 0;

            for (const test of tests) {
                try {
                    await test.func();
                    passed++;
                    summary += `‚úÖ ${test.name}: PASSED\n`;
                } catch (error) {
                    failed++;
                    summary += `‚ùå ${test.name}: FAILED\n`;
                }
                // Wait a bit between tests
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            summary += `\n\n‚úÖ Passed: ${passed}\n‚ùå Failed: ${failed}\n\nTotal: ${tests.length} tests`;

            const type = failed === 0 ? 'success' : 'info';
            showResult(resultId, summary, type);
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            console.log('üß™ API Integration Test Page Loaded');
            console.log('API Base URL:', API_BASE_URL);
            console.log('Click the buttons above to test individual endpoints or run all tests at once.');
        });
    </script>
</body>

</html>